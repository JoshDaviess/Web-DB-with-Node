<!doctype html>
<meta charset="utf-8">
<title>HappyOnlineShop</title>
<link rel="stylesheet" href="happystore.css">

<h1>Happy Online ☺︎ Shop Order Tracking</h1>

<main>
    Order data:
    <pre id="order"></pre>
    <button onclick="loadOrder();">reload</button>
</main>
    
</pre>



<script>

    'use strict';
    var apiKey = 'orewgthwoetgoirwejgboerigqt';
    
    function loadOrder() {
        var orderURI = getParameterByName('id');
        if (orderURI === '') {
            byId('order').textContent = "no order specified";
            return;
        }

        var xhr = new XMLHttpRequest();
        xhr.onload = populateOrderData;
        xhr.onerror = apiFail(); 
        xhr.open("get", orderURI, true, apiKey);
        xhr.send();
    }

    // function from http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    function populateOrderData() {
        if (this.status >= 300) return apiFail();

        var data = JSON.parse(this.responseText);
        byId('order').textContent = JSON.stringify(data, null, 2);
    }

    function apiFail() {
        byId('order').textContent = "error loading order " + getParameterByName('id');
    }

    function byId(id) { 
        return document.getElementById(id);
    }

    document.body.onload = loadOrder;
</script>
